<?php

use yii\db\Migration;

class m191018_145935_common_action_log extends Migration
{
    public function up()
    {
        /* 取消外键约束 */
        $this->execute('SET foreign_key_checks = 0');
        
        /* 创建表 */
        $this->createTable('{{%common_action_log}}', [
            'id' => "int(10) NOT NULL AUTO_INCREMENT COMMENT '主键'",
            'merchant_id' => "int(10) unsigned NULL DEFAULT '0' COMMENT '商户id'",
            'app_id' => "varchar(50) NULL DEFAULT '' COMMENT '应用id'",
            'user_id' => "int(10) NOT NULL DEFAULT '0' COMMENT '用户id'",
            'behavior' => "varchar(50) NULL DEFAULT '' COMMENT '行为类别'",
            'method' => "varchar(20) NULL DEFAULT '' COMMENT '提交类型'",
            'module' => "varchar(50) NULL DEFAULT '' COMMENT '模块'",
            'controller' => "varchar(50) NULL DEFAULT '' COMMENT '控制器'",
            'action' => "varchar(50) NULL DEFAULT '' COMMENT '控制器方法'",
            'url' => "varchar(200) NULL DEFAULT '' COMMENT '提交url'",
            'get_data' => "json NULL COMMENT 'get数据'",
            'post_data' => "json NULL COMMENT 'post数据'",
            'header_data' => "json NULL COMMENT 'header数据'",
            'ip' => "varchar(16) NULL DEFAULT '' COMMENT 'ip地址'",
            'remark' => "varchar(1000) NULL DEFAULT '' COMMENT '日志备注'",
            'country' => "varchar(50) NULL DEFAULT '' COMMENT '国家'",
            'provinces' => "varchar(50) NULL DEFAULT '' COMMENT '省'",
            'city' => "varchar(50) NULL DEFAULT '' COMMENT '城市'",
            'device' => "varchar(200) NULL DEFAULT '' COMMENT '设备信息'",
            'status' => "tinyint(4) NOT NULL DEFAULT '1' COMMENT '状态[-1:删除;0:禁用;1启用]'",
            'created_at' => "int(10) NOT NULL DEFAULT '0' COMMENT '创建时间'",
            'updated_at' => "int(10) unsigned NULL DEFAULT '0' COMMENT '修改时间'",
            'PRIMARY KEY (`id`)'
        ], "ENGINE=InnoDB  DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='系统_行为表'");
        
        /* 索引设置 */
        
        
        /* 表数据 */
        $this->insert('{{%common_action_log}}',['id'=>'1','merchant_id'=>'1','app_id'=>'backend','user_id'=>'1','behavior'=>'login','method'=>'POST','module'=>'backend','controller'=>'site','action'=>'login','url'=>'site/login','get_data'=>'[]','post_data'=>'[]','header_data'=>'{"host": ["lanhai.liu.com"], "accept": ["text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3"], "cookie": ["advanced-frontend=4nm6kdsgi9u07bm1jfomd7qte9; _csrf-frontend=8dfd8a8b9d293a560bcf7a0ed55a1f9450777dfcbfe9bd41e75c8b9097bc12d0a%3A2%3A%7Bi%3A0%3Bs%3A14%3A%22_csrf-frontend%22%3Bi%3A1%3Bs%3A32%3A%22Cxq7zLlvx0IAwvsinND0dBDlMQoM85cR%22%3B%7D; advanced-backend=ontvl6dbdq99cl4hse8f8ca3p6; _csrf-backend=b32a1d34f00a9d225b15863fa01b9165c925d999b7ec96d64af72bdbb1b40ec0a%3A2%3A%7Bi%3A0%3Bs%3A13%3A%22_csrf-backend%22%3Bi%3A1%3Bs%3A32%3A%22pWmn3IZ10O8TgYfJt5SqORaF0edQhFgc%22%3B%7D"], "origin": ["http://lanhai.liu.com"], "referer": ["http://lanhai.liu.com/backend/site/login"], "connection": ["keep-alive"], "user-agent": ["Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36"], "content-type": ["application/x-www-form-urlencoded"], "cache-control": ["max-age=0"], "content-length": ["237"], "accept-encoding": ["gzip, deflate"], "accept-language": ["zh-CN,zh;q=0.9"], "upgrade-insecure-requests": ["1"]}','ip'=>'2886860801','remark'=>'账号登录','country'=>'局域网','provinces'=>'局域网','city'=>'','device'=>'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36','status'=>'1','created_at'=>'1571150835','updated_at'=>'1571150835']);
        $this->insert('{{%common_action_log}}',['id'=>'2','merchant_id'=>'1','app_id'=>'backend','user_id'=>'1','behavior'=>'configUpdateInfo','method'=>'POST','module'=>'common','controller'=>'config','action'=>'update-info','url'=>'common/config/update-info','get_data'=>'[]','post_data'=>'{"config": {"sys_dev": "1", "sys_tags": "1", "sys_allow_ip": "", "sys_related_links": "0", "sys_ip_blacklist_open": "0", "sys_image_watermark_status": "0", "sys_image_watermark_location": "1"}, "_csrf-backend": "a3JwL4tJYNaYxei5z9KNH67aSIUx0Fb9bbpiEMdBRZQHP0l93BoDssqEp9Oft9d0-ZAFqHi_OKUOzA9_9XIB2Q=="}','header_data'=>'{"host": ["lanhai.liu.com"], "accept": ["application/json, text/javascript, */*; q=0.01"], "cookie": ["advanced-frontend=4nm6kdsgi9u07bm1jfomd7qte9; advanced-backend=o9j8s4pprp03p6equ8de76lbi4; _identity-backend=624c37e8b12e98dd06f684925b738bc9ed02bab0bbfb4c48a7dba2a93aab2904a%3A2%3A%7Bi%3A0%3Bs%3A17%3A%22_identity-backend%22%3Bi%3A1%3Bs%3A46%3A%22%5B1%2C%22z6lrwixmdNF4VqtkXw6z-3vMZdSdngm2%22%2C2592000%5D%22%3B%7D; _csrf-backend=5588e29759e208bb0c568efeaac060a5609df42536d36bc0d6c06b54ba4a18e2a%3A2%3A%7Bi%3A0%3Bs%3A13%3A%22_csrf-backend%22%3Bi%3A1%3Bs%3A32%3A%22lM9RWScdRAOjPeZkWJM-IonXcvmo23DM%22%3B%7D; _csrf-frontend=c18b7febafb961031e030fe48552554a12c83548739d52d0384ea3c85d78e79aa%3A2%3A%7Bi%3A0%3Bs%3A14%3A%22_csrf-frontend%22%3Bi%3A1%3Bs%3A32%3A%22zJvscRfU6jjkVB4STzNFD9N_LITPY_yQ%22%3B%7D"], "origin": ["http://lanhai.liu.com"], "referer": ["http://lanhai.liu.com/backend/common/config/edit-all"], "connection": ["keep-alive"], "user-agent": ["Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36"], "content-type": ["application/x-www-form-urlencoded; charset=UTF-8"], "x-csrf-token": ["a3JwL4tJYNaYxei5z9KNH67aSIUx0Fb9bbpiEMdBRZQHP0l93BoDssqEp9Oft9d0-ZAFqHi_OKUOzA9_9XIB2Q=="], "content-length": ["329"], "accept-encoding": ["gzip, deflate"], "accept-language": ["zh-CN,zh;q=0.9"], "x-requested-with": ["XMLHttpRequest"]}','ip'=>'2886860801','remark'=>'修改配置信息','country'=>'局域网','provinces'=>'局域网','city'=>'','device'=>'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36','status'=>'1','created_at'=>'1571157799','updated_at'=>'1571157799']);
        $this->insert('{{%common_action_log}}',['id'=>'3','merchant_id'=>'1','app_id'=>'backend','user_id'=>'1','behavior'=>'configUpdateInfo','method'=>'POST','module'=>'common','controller'=>'config','action'=>'update-info','url'=>'common/config/update-info','get_data'=>'[]','post_data'=>'{"config": {"web_site_icp": "", "web_copyright": "© 2019 - 2020 蓝海引擎 All Rights Reserved.", "web_baidu_push": "", "web_site_title": "蓝海引擎", "web_visit_code": "", "web_seo_keywords": "", "web_seo_description": ""}, "_csrf-backend": "OwOlCp_5ld7a20HYtbCABkXbKPr6azTmb4DbM5DdvKtXTpxYyKr2uoiaDrLl1dptEpFl17MEWr4M9rZcou745g=="}','header_data'=>'{"host": ["lanhai.liu.com"], "accept": ["application/json, text/javascript, */*; q=0.01"], "cookie": ["advanced-frontend=4nm6kdsgi9u07bm1jfomd7qte9; advanced-backend=o9j8s4pprp03p6equ8de76lbi4; _identity-backend=624c37e8b12e98dd06f684925b738bc9ed02bab0bbfb4c48a7dba2a93aab2904a%3A2%3A%7Bi%3A0%3Bs%3A17%3A%22_identity-backend%22%3Bi%3A1%3Bs%3A46%3A%22%5B1%2C%22z6lrwixmdNF4VqtkXw6z-3vMZdSdngm2%22%2C2592000%5D%22%3B%7D; _csrf-backend=5588e29759e208bb0c568efeaac060a5609df42536d36bc0d6c06b54ba4a18e2a%3A2%3A%7Bi%3A0%3Bs%3A13%3A%22_csrf-backend%22%3Bi%3A1%3Bs%3A32%3A%22lM9RWScdRAOjPeZkWJM-IonXcvmo23DM%22%3B%7D; _csrf-frontend=c18b7febafb961031e030fe48552554a12c83548739d52d0384ea3c85d78e79aa%3A2%3A%7Bi%3A0%3Bs%3A14%3A%22_csrf-frontend%22%3Bi%3A1%3Bs%3A32%3A%22zJvscRfU6jjkVB4STzNFD9N_LITPY_yQ%22%3B%7D"], "origin": ["http://lanhai.liu.com"], "referer": ["http://lanhai.liu.com/backend/common/config/edit-all"], "connection": ["keep-alive"], "user-agent": ["Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36"], "content-type": ["application/x-www-form-urlencoded; charset=UTF-8"], "x-csrf-token": ["OwOlCp_5ld7a20HYtbCABkXbKPr6azTmb4DbM5DdvKtXTpxYyKr2uoiaDrLl1dptEpFl17MEWr4M9rZcou745g=="], "content-length": ["418"], "accept-encoding": ["gzip, deflate"], "accept-language": ["zh-CN,zh;q=0.9"], "x-requested-with": ["XMLHttpRequest"]}','ip'=>'2886860801','remark'=>'修改配置信息','country'=>'局域网','provinces'=>'局域网','city'=>'','device'=>'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36','status'=>'1','created_at'=>'1571157856','updated_at'=>'1571157856']);
        $this->insert('{{%common_action_log}}',['id'=>'4','merchant_id'=>'1','app_id'=>'backend','user_id'=>'1','behavior'=>'logout','method'=>'POST','module'=>'backend','controller'=>'site','action'=>'logout','url'=>'site/logout','get_data'=>'[]','post_data'=>'{"_csrf-backend": "OM_aC45lk8VKuqoDJ3ngkHn9JYRvsYlj9o4qk7plW2RUguNZ2TbwoRj75Wl3HLr7LrdoqSbe5zuV-Ef8iFYfKQ=="}','header_data'=>'{"host": ["lanhai.liu.com"], "accept": ["text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3"], "cookie": ["advanced-frontend=4nm6kdsgi9u07bm1jfomd7qte9; advanced-backend=o9j8s4pprp03p6equ8de76lbi4; _identity-backend=624c37e8b12e98dd06f684925b738bc9ed02bab0bbfb4c48a7dba2a93aab2904a%3A2%3A%7Bi%3A0%3Bs%3A17%3A%22_identity-backend%22%3Bi%3A1%3Bs%3A46%3A%22%5B1%2C%22z6lrwixmdNF4VqtkXw6z-3vMZdSdngm2%22%2C2592000%5D%22%3B%7D; _csrf-backend=5588e29759e208bb0c568efeaac060a5609df42536d36bc0d6c06b54ba4a18e2a%3A2%3A%7Bi%3A0%3Bs%3A13%3A%22_csrf-backend%22%3Bi%3A1%3Bs%3A32%3A%22lM9RWScdRAOjPeZkWJM-IonXcvmo23DM%22%3B%7D; _csrf-frontend=c18b7febafb961031e030fe48552554a12c83548739d52d0384ea3c85d78e79aa%3A2%3A%7Bi%3A0%3Bs%3A14%3A%22_csrf-frontend%22%3Bi%3A1%3Bs%3A32%3A%22zJvscRfU6jjkVB4STzNFD9N_LITPY_yQ%22%3B%7D"], "origin": ["http://lanhai.liu.com"], "referer": ["http://lanhai.liu.com/backend/"], "connection": ["keep-alive"], "user-agent": ["Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36"], "content-type": ["application/x-www-form-urlencoded"], "cache-control": ["max-age=0"], "content-length": ["106"], "accept-encoding": ["gzip, deflate"], "accept-language": ["zh-CN,zh;q=0.9"], "upgrade-insecure-requests": ["1"]}','ip'=>'2886860801','remark'=>'退出登录','country'=>'局域网','provinces'=>'局域网','city'=>'','device'=>'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36','status'=>'1','created_at'=>'1571410266','updated_at'=>'1571410266']);
        $this->insert('{{%common_action_log}}',['id'=>'5','merchant_id'=>'1','app_id'=>'backend','user_id'=>'1','behavior'=>'login','method'=>'POST','module'=>'backend','controller'=>'site','action'=>'login','url'=>'site/login','get_data'=>'[]','post_data'=>'[]','header_data'=>'{"host": ["lanhai.liu.com"], "accept": ["text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3"], "cookie": ["advanced-frontend=4nm6kdsgi9u07bm1jfomd7qte9; _csrf-backend=5588e29759e208bb0c568efeaac060a5609df42536d36bc0d6c06b54ba4a18e2a%3A2%3A%7Bi%3A0%3Bs%3A13%3A%22_csrf-backend%22%3Bi%3A1%3Bs%3A32%3A%22lM9RWScdRAOjPeZkWJM-IonXcvmo23DM%22%3B%7D; _csrf-frontend=c18b7febafb961031e030fe48552554a12c83548739d52d0384ea3c85d78e79aa%3A2%3A%7Bi%3A0%3Bs%3A14%3A%22_csrf-frontend%22%3Bi%3A1%3Bs%3A32%3A%22zJvscRfU6jjkVB4STzNFD9N_LITPY_yQ%22%3B%7D; advanced-backend=dhpltk42558inbrii5pd74t72n"], "origin": ["http://lanhai.liu.com"], "referer": ["http://lanhai.liu.com/backend/site/login"], "connection": ["keep-alive"], "user-agent": ["Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36"], "content-type": ["application/x-www-form-urlencoded"], "cache-control": ["max-age=0"], "content-length": ["237"], "accept-encoding": ["gzip, deflate"], "accept-language": ["zh-CN,zh;q=0.9"], "upgrade-insecure-requests": ["1"]}','ip'=>'2886860801','remark'=>'账号登录','country'=>'局域网','provinces'=>'局域网','city'=>'','device'=>'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36','status'=>'1','created_at'=>'1571410273','updated_at'=>'1571410273']);
        
        /* 设置外键约束 */
        $this->execute('SET foreign_key_checks = 1;');
    }

    public function down()
    {
        $this->execute('SET foreign_key_checks = 0');
        /* 删除表 */
        $this->dropTable('{{%common_action_log}}');
        $this->execute('SET foreign_key_checks = 1;');
    }
}

